version: 2
jobs:
  build:
    working_directory: ~/bin

    docker:
      - image: debian:buster

    steps:
      - run:
          name: Install dependencies
          command: apt update && apt upgrade && apt install -y jq git openssh-client syslog-ng wget curl

      - checkout

      - run:
          name: Start syslog-ng
          command: service syslog-ng start

      - run:
          name: Configure prerequisites
          command: wget https://www.fisc.us/dark-lie_ip.token && wget https://www.fisc.us/dark-lie_ds.token

      - run:
          name: Run dark-lie
          command: bash dark-lie